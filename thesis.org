#+TITLE: Reinforcement Learning Portfolio Optimization of Electric Vehicle Virtual Power Plants
#+AUTHOR:Tobias Richter

#+INCLUDE: "./header.org"
# #+INCLUDE: "./chapters/introduction.org"
# #+INCLUDE: "./chapters/background.org"
# #+INCLUDE: "./chapters/empirical-setting.org"
# #+INCLUDE: "./chapters/model.org"

* Simulation Platform: FleetSim
# NOTE: 5%
# NOTE: Cite Ketter PowerTac (and Competitive Benchmarking)
- Simulation Platform to allow evaluating the performance of intelligent agents
  in smart charging/balancing the grid of EV fleets. Allows to test out bidding
  strategies and control mechanisms in a realistic EV fleet setting.
- Real life comparison graph: 10%.
** Event-based Simulation
- Not only t+1
- Event e.g. denying rental, charge/little charge/no-charge has effects for the
  whole simulation
- Simpy
- Python
** Architecture / Components
#+CAPTION[FleetSim Architecture]: Architecture of FleetSim label:fig-fleetsim
#+ATTR_LATEX: :width 1\linewidth
[[./fig/simulation_platform.png]]

** Modular Expandability
- Plug-in different Market designs
- Use different real-world data
- Change Fleet parameters
- Develop new strategy
-
#+LATEX: \clearpage
* Results
# NOTE: 15%
# NOTE: What about infer charging stations?
# - Run regular with charging stations
# - Run strategy with no/less regular charging
# NOTE: Also include overview graphs, of charging, prices, available capacity,
# car2go trips, etc..
# NOTE: Include overview graphs of different RL methods over time
# NOTE: List Simulation params in a table: Car Capacity etc..
# NOTE: Make decision outcome results table over one-year period like kahlen
# NOTE: Include EUR & MWh charged energy!
** Simulation Environment

  #+CAPTION[Simulation Parameters]: Simulation Parameters
  #+ATTR_LATEX: :environment longtable :align l|cc :placement [hp]
  |----------------------------+----------------------------+-----------|
  |----------------------------+----------------------------+-----------|
  | Parameter                  | Value                      | Notation  |
  |----------------------------+----------------------------+-----------|
  | EV battery capacity        | 16.7 $\kwh$                | $\Omega$  |
  | EV charging power          | 3.6 $\kw$                  | $\gamma$  |
  | EV range                   | 160 km                     |           |
  | Industry electricity price | 0.15[fn:1] $\ekwh$         | $p^{ind}$ |
  | Car2Go Rental Tariff       | 0.15[fn:1] $\eur$ / minute |           |
  |----------------------------+----------------------------+-----------|
  |----------------------------+----------------------------+-----------|

- No extra Car2Go fees after 50km, etc..?

  #+CAPTION[Simulation Statistics]: Simulation Statistics
  #+ATTR_LATEX: :environment longtable :align l|c :placement [hp]
  |----------------------------------------+-----------------------------|
  |----------------------------------------+-----------------------------|
  | Statistic                              | Value                       |
  |----------------------------------------+-----------------------------|
  | Fleet size                             | 508                         |
  | Number charging stations               | [trips.pkl]                 |
  | EVs available (min, *avg*, max, *std*) | 165, *389.64*, 496, *49.18* |
  | EVs charging (min, *avg*, max, *std*)  | 34, *61.23*, 290, *61.11*   |
  | VPP EVs (min, *avg*, max, *std*)       | 0, *13.84*, 94, *9.01*      |
  |----------------------------------------+-----------------------------|
  |----------------------------------------+-----------------------------|

- Footnote: Run with Data from ... till ...

- Results heavily dependent on industry charging price, since on average the
  balancing prices are 50% cheaper, and intraday 30% cheaper.


#+CAPTION[Fleet Utilzation]: Daily fleet utilization (average, standard deviation) from June 6, 2016 to January 1, 2018. The blue error band is illustrating the large volatility in the amount of EVs that get parked at a charging station. The share of EVs that can be used as VPP is on average only 2.9%. Most of the EVs are either not connected to a charging station or are already fully charged.
#+ATTR_LATEX: :width 1\linewidth
[[./fig/fleet-utilization.png]]


** Fleet Profits 1. RQ
- 1. RQ: Monthly gross profit increase with benchmark strategy: Bar-Plot? (integrated naive
  strategy)
- Error Matrix? Predicted available EVs vs actually available --> Fixed by
  simulation! No result

#+LATEX: {\captionsetup[table]{aboveskip=0.5cm}
#+CAPTION[Bidding strategy outcomes]: Outcomes of naive bidding strategies over a 1.5 year period label:table-profits
#+ATTR_LATEX: :float sideways :align p{0.25\linewidth}|cccccc :placement [hp]
|                                     | \thead{Regular\\charging} | \thead{Balancing\\(risk averse)} | \thead{Intraday\\(risk averse)} | \thead{Integrated\\(risk averse)} | \thead{Integrated\\(risk seeking)} | \thead{Integrated\\(benchmark)} |
|-------------------------------------+---------------------------+----------------------------------+---------------------------------+-----------------------------------+------------------------------------+---------------------------------|
|-------------------------------------+---------------------------+----------------------------------+---------------------------------+-----------------------------------+------------------------------------+---------------------------------|
| VPP Utilization (%)                 |                         0 |                               39 |                              47 |                                62 |                                 81 |                              91 |
| Energy bought (MWh)                 |                         0 |                              803 |                             985 |                              1292 |                               1681 |                            1884 |
| Energy charged regularly (MWh)      |                      2081 |                             1278 |                            1096 |                               789 |                                400 |                             197 |
| Lost rental profits (1000 \eur)     |                         0 |                                0 |                               0 |                                 0 |                              15.47 |                               0 |
| No. Lost rentals                    |                         0 |                                0 |                               0 |                                 0 |                               1237 |                               0 |
| Imbalances (MWh)                    |                         0 |                                0 |                               0 |                                 0 |              \textcolor{red}{1.01} |                               0 |
| Average electricity price ($\ekwh$) |                      0.15 |                                - |                               - |                                 - |                                  - |                               - |
| Gross profit increase (1000 \eur)   |                         0 |                            43.62 |                           45.08 |                           *67.04* |                            *72.51* |                           99.13 |
|-------------------------------------+---------------------------+----------------------------------+---------------------------------+-----------------------------------+------------------------------------+---------------------------------|
|-------------------------------------+---------------------------+----------------------------------+---------------------------------+-----------------------------------+------------------------------------+---------------------------------|
# #+TBLFM: @2=round(100*round(@3/(@3+@4),2))
# ::@10=100* round((@9/17707.85),4)
#+LATEX:}

#+BEGIN_SRC python :exports none
return(87.98 - 15.47)
#+END_SRC

#+RESULTS:
: 72.51

** RL Learning 2. RQ
# NOTE: What about confidence intervals - Mean?
- long-delayed rewards make RL hard (!?)
- positive reward from buying immediatly vs negative rewards up to 7 days.
- Compare RL Algos eg. Q-learning vs DDQN --> deep learning makes difference in
  practice for complex system. Reward per timestep or Profits
  - https://github.com/dennybritz/reinforcement-learning/blob/master/TD/Q-Learning%20Solution.ipynb
  - https://gist.github.com/vihar/dcb1272a04b98ce3fdb2c109af7eaa21#file-q-learning-py
- Accumulative/Single reward over time. With learning, without learning(real-world)?
- Costs of charging RL vs optimal benchmark (full information, no uncertainty)
  vs. regular charging

- Prob distribution of optimal actions for the fleet during weekdays. cite:vaya14_optim

** Sensitivity Analysis
# NOTE: Prediction Accuracy of available EV capacity
# NOTE: Balancing accuracy always lower than intraday! Otherwise no sense
# NOTE: Do predict electricity prices?
*** Prediction Accuracy
- Compare profits of (50%, 60%, 70%, 80%, 90%, 100%)

*** Charging infrastructure
- Fastchargers (22kw)
- Car batteries
- More Charging Stations (infer charging stations)

*** Bidding Mechanism
# NOTE: Relaxed minimum bidding assumption of 1MW to no limit.
- Minimal bidding quantities (100kw, 500kw, 1MW)

* Conclusion
# NOTE 5%
** Contribution
- Compare to most simular studies:
cite:kahlen18_elect_vehic_virtual_power_plant_dilem,vandael15_reinf_learn_heuris_ev_fleet etc..
- Business model for EV fleet owners with better results than previous studies
- Environmental impact by providing balancing power
- Decision Support System for controlled EV charging from multiple markets
- RL Algorithm that is designed to work in previously unknown environments and
  thus suited to deploy in real life settings of all kinds of EV fleets in all
  kinds of cities. E.g. scooters also?
- Event-based Simulation Platform to evaluate bidding strategies and RL agents,
  facilitate research

** Limitations
# # NOTE: Citatation from kahlen
# The fleet controller offers bids and asks for every time interval. These offers
# contain both a quantity and a reservation price, which depends on the state of
# charge of the EV storage, as well as on the battery costs. However, the market
# may or may not accept these offers depending on the composition of the offer
# prices from the fleet owner and other market participants. The market auction
# mechanism ultimately decides when EVs will charge and discharge.
- Model:
  - Bidding Mechanism: one week ahead, always accepted
  - Policy & Regulation: EVs not allowed to provide balancing power, minimum
    bidding quantities 1MW.
  - Markets: Fleet is a price-taker, what about larger fleets? Simulate market influence
- RL: See cite:vazquez-canteli19_reinf_learn_deman_respon conclusion for
  limitations.
** Future Research
- Model: Current market design, i.e. daily w/ 4h slots. German "Mischpreisverfahren"
- RL: Long-delayed rewards, different reward structure, memory based

#+LATEX: \clearpage
bibliography:~/uni/ma-thesis/bibliography/references.bib
bibliographystyle:apacite

* Footnotes

[fn:1] Average industry electricity price for 2017 BMWi. (n.d.). Prices of
electricity for the industry in Germany from 2008 to 2017 (in euro cents per
kilowatt hour). In Statista - The Statistics Portal. Retrieved March 18, 2019,
from
https://www.statista.com/statistics/595803/electricity-industry-price-germany/.

[fn:2] https://colab.research.google.com

[fn:3] https://github.com/keras-rl/keras-rl

[fn:4] https://www.keras.io
